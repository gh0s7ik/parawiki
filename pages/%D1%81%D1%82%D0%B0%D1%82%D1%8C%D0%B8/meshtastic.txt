====== Устройства Meshtastic: инструкция ======
==== Что такое Meshtastic? ====
=== Почему Meshtastic? ===
Главная особенность устройств Meshtastic: они передают геопозицию и сообщения друг другу, не используя сотовую связь.
=== Сеть Meshtastic в Бире === 
Так в [[места:bir|Бире]] группа волонтёров устанавливает «базовые» станции Meshtastic по основным горным хребтам.
С помощью этих станций, пилоты отслеживаются на сайтах трекерах.
[[статьи:puretrack.io|«Добавив себя»]] на такой сайт с картой, ваши друзья и другие пилоты будут видеть ваш трек и в режиме реального времени, и несколько часов и даже дней после потери сигнала.
Добавьте себе безопасности в [[места:bir|Бире]].
И даже если у вас нет Meshtastic устройства, [[статьи:puretrack.io|добавьте на сайт puretrack.io]] трансляцию своей геопозиции из приложения XCTrack.
=== Как летать в компании без «базовой» сети? ===
А если вы летаете в компании друзей с устройствами, то можно подключить одно из устройств к смартфону. Если у смартфона есть сотовая связь, он передаст все геопозиции всех видимых устройств на карту.
----

==== Где купить устройства Meshtastic ====
=== Какие бывают устройства ===

{{:статьи:meshtastic:screen-20.png|}}
  1. Прибор LILYGO TTGO Meshtastic T-Beam
  * В корпусе
  * Немного более емкая батарейка, встроена в корпус
  * Нет возможности подключить к WiFi
-
{{:статьи:meshtastic:screen-21.png|}}
  2. Плата LILYGO TTGO Meshtastic T-Echo
  * Немного дешевле
  * Нет корпуса
  * Батарейка съемная, менее емкая
  * Есть возможность подключиться через WiFi


Для того что бы устройство работало в Бире (Индия) и в России устройство должно работать на частоте **868 МГц**

=== Где купить ===
Конечно ссылки могут устареть, но вот для примера.
Покупайте вариант с частотой **868 МГц**!
Устройства:
  * [[https://www.ozon.ru/search/?text=LILYGO+TTGO+T-Beam+ESP32+Meshtastic+868+МГц&from_global=true|LILYGO TTGO T-Beam На OZON]]
  * [[https://aliexpress.ru/item/1005002988035811.html?sku_id=12000039822835784&spm=a2g2w.productlist.search_results.0.685b36c4hxx0vX|LILYGO TTGO Meshtastic T-Beam на AliExpress]]
  * [[https://aliexpress.ru/item/1005002842456390.html?spm=a2g2w.orderdetail.0.0.58cd4aa6Ygp36x&sku_id=12000037263417079&_ga=2.219201754.292530119.1762950508-1718285868.1727282327|LILYGO TTGO Meshtastic T-Echo модуль на AliExpress]]

===Антенны===
Обратите внимание что, как правило, устройства продаются с антенной не соответствующей частоте **868 МГц**.
Работать будет, но не так хорошо как с «правильной» антенной.
Рекомендую купить и заменить дефолтную антенну на «правильную», сделанную специально для частоты **868 МГц**.

  * [[https://www.ozon.ru/search/?text=%D0%B0%D0%BD%D1%82%D0%B5%D0%BD%D0%BD%D0%B0+868+%D0%BC%D0%B3%D1%86+lora&from_global=true|На OZON]]
  * [[https://aliexpress.ru/wholesale?SearchText=антенны+868+МГц&g=y&page=1&searchInfo=A5W8NsA69ltqZLmSc%2Bs0tUNvgJTeYhkjrYUxjDMdL5EDCVLaa63wdL%2F1f4A%2Bvyt9fRL3kSJVGcEP4w3bl%2FznxJLGkfUSbfyd8o%2FaW2B9mjD%2Ba8foq%2FMMW3boxO9nE%2BlSgOBfahwv%2BTneijSDQS8pCb8rS%2FLSMO5sJJHoF2xc55qYP%2BEVPbOBS5MI|На AliExpress]]

==== Установка Meshtastik на устройство====
Часто бывает что на купленном прибор **LILYGO T-Echo** не установлен Meshtastik.
Это можно понять что при включении на экране прибора нет надписи Meshtastik и в приложении на смартфоне устройство не подключается.
=== Как установить Meshtastik на LILYGO T-Echo===
  * Подключаем кабелем прибор к компьютеру. Возможно операционная система распознает устройство как не отформатированный диск и предложит его отформатировать. Делать этого не надо, хотя вреда это действо не нанесет.
  * Открываем на компьютере сайт [[https://flasher.meshtastic.org/|flasher.meshtastic.org]]
  * Выбираем устройство: кнопка "Выбор целевого устройства", затем вручную выбираем устройство **LILYGO T-Echo**.
  * Выбираем прошивку: в раскрывающемся списке с прошивками (кнопка над надписью "Прошивка") выбираем стабильную (или бета-версию). Самую верхнюю в списке версию со словом "Beta".
  * Нажимаем кнопку "Прошить". Откроется экран с предупреждением, внизу которого нажимаем кнопку "Продолжить".
  * Далее нужно скачать файл с расширением uf2 на подключенное устройство. По умолчанию устройство не определяется как внешний диск. Что бы перевести устройство в так называемый "DFU режим", необходимо на устройстве два раза нажать кнопку Reset. На **LILYGO T-Echo** это верхняя кнопка. Устройство должно перегрузиться и операционная система определит его как внешний диск. Если не получилось с первого раза попробуйте еще.
  * Собственно на этот диск нужно либо скачать либо скопировать ранее скачанный файл с расширением uf2. Как только сохранение\копирование файла на диск устройства завершиться, устройство автоматически перегрузится и установит Meshtastik из файла.
  * Если все пройдет успешно, на экране устройства отобразится надпись Meshtastik и прочая информация. Так же устройство подключиться к приложения в смартфоне.

==== Настройка устройства Meshtastik ====
=== Создаём файл настроек ===
  * Для быстрой настройки устройства Meshtastic специально для сети в Бире (Индия) есть сайт для создания файла настройки.
  - Открываем [[https://live.paratracker.in/?configure|раздел конфигураций на сайте live.paratracker.in]]
  * Необходимо придумать и ввести длинное имя и короткое имя, **long name** и **short name**.
  * Длина обоих полей ограничена по длине, подумайте что написать.
  * На основе этих имён генерируется название вашего устройства в сети Meshtastic.
  - Вводим имена, нажимаем кнопку «Generate my config».
  * Сохраняем файл на смартфон. Он будет нужен для настройки прибора в приложении.

{{:статьи:meshtastic:screen-10.png|}}

----

=== Приложение Meshtastik ===
Скачиваем и устанавливаем приложение Meshtastik на свой смартфон:
  * Приложение для Android в [[https://play.google.com/store/apps/details?id=com.geeksville.mesh|play.google.com]]
  * Приложение Apple в [[https://apps.apple.com/us/app/meshtastic/id1586432531|apple.com]]

=== Настройка устройства в приложении (на примере Android) ===
== Подключение ==
  * Включаем устройство.
  * На смартфоне включаем Bluetooth, подключаем устройство, пароль будет отображаться на экране устройства Meshtastik.
  * Открываем приложение.
  * На вкладке "Соединения", в списке "Paired devices" выбираем ваше устройство Meshtastik. Название будет соответствовать имени устройства в Bluetooth.
  * Для подключения нажимаем кнопку "Сканирования".
  * Подключенное устройство будет отображаться в "Подключенные устройства".

{{:статьи:meshtastic:screen01.jpg?200|}}

== Выбор страны ==
  * Нажимаем кнопку "Установить ваш регион".
  * В поле Регион/Страна нужно выбрать «India».
  * Нажимаем "Сохранить". 
  * Устройство перезагрузиться. Необходимо будет дождаться загрузки устройства и снова подключиться к нему в приложении.

{{:статьи:meshtastic:screen02.jpg?200|}}

== Загрузка файла настройки ==
  * Во вкладке "Настройки" выбираем пункт «Импорт настроек».
  * Выбираем файл настройки, созданный ранее и скачанный на телефон.
  * В диалоге "Импорт настроек" оставляем включенными все опции-переключатели.
  * Нажимаем "Сохранить".
  * Устройство перезагрузиться. Необходимо будет дождаться загрузки устройства и снова подключиться к нему в приложении.
  * После перезагрузки устройство уже будет отображаться под новым именем, тем что вы задали при создании файла настройки.
  * На основе файла приложение задает все необходимые настройки устройства для его работы в сети Bircom.
  * На вкладке "Узлы" в списке узлов должно появиться ваше устройство с заданным вами именем и статусной информацией.
  * Ваш Meshtastic подключен к сети бира!

{{:статьи:meshtastic:screen03.jpg?200|}}

----

=== Где взять ID устройства для регистрации его на сайте puretrack.io ===
  * В приложении Meshtastic, во кладке "Настройки", в разделе «Настройки устройства» выбираем пункт "Пользователь".
  * В разделе "Настройки пользователя", напротив надписи «ID узла» отображается искомый ID. Обычно он выглядит примерно так: **!6c25eaf0**

{{:статьи:meshtastic:screen04.jpg?200|}}

----
**Не забудьте** настроить трансляцию своей геопозиции с Meshtastic устройства на сайт puretrack.io

Как это сделать описано в [[статьи:puretrack.io|отдельной статье про сайт puretrack.io]] 

==== Как работает передача геопозиции? ====
Итак, мы настроили устройство с помощью сгенерированного файла настроек для «Бирской сети». Прибор начнет передавать другим устройствам свою геопозицию при нескольких условиях. Рассмотрим их.

=== Устройство «видит» спутники ===
Как и большинство приборов работающих со спутниками, устройству Meshtastic потребуется некоторое время чтобы «увидеть» спутники. Так называемый «холодный старт».
Увидеть что Meshtastic подключил спутники можно на экранчике устройства. Переключайте экраны кнопкой и ищите строчку со статусом подключения к спутникам. 

=== Передача только в движении ===
«Настройки для Бира» предполагают, что передача данных происходит только если за заданный промежуток координаты изменились. Иначе говоря, данные начинают передаваться когда вы начнете двигаться, лететь.
Этот алгоритм настроен для экономии энергии и уменьшения загрузки сети. Его можно изменить настройками, но я не рекомендую это делать.

----
==== Как написать сообщение в сеть ====
=== Написать сообщение в общий канал и чат в Телеграмме ===
//В работе//
----


==== Передача данных с устройства в интернет ====
Можно настроить передачу данных с вашего устройства в интернет через ваш смартфон. Но ваш смартфон должен быть подключен к мобильной сети.
Таким образом, все другие Meshtastic устройства, у которых будет связь с вшим устройством, тоже смогут передать данные о своем местоположении в интернет, на карты и т.д.

=== Включаем "ретрансляцию" сообщений через устройство ===
  * Во вкладке "Настройки" в разделе "Настройки устройства" выбираем "Каналы". Нажимаем на канал "LongFast".
  * Включите переключатели "Uplink enabled", "Downlink enabled" для активации отправки и приёма сообщений и телеметрии через MQTT.
  * Нажимаем "Сохранить", затем уже в разделе "Каналы", жмем кнопку "Отправить".

=== Передача данных по Bluetooth  ===
Что бы устройство передавало данные через смартфон, достаточно:
  * что бы устройство было постоянно подключено в приложении по Bluetooth в вашем смартфоне,
  * что бы смартфон был подключен к сотовой сети.

=== Передача данных через WiFi ===
  * На смартфоне включаем Точку доступа WiFi. Запоминаем название точки доступа и пароль.
  * При желании, можно отключить переключатель "Автоматически выключать точку доступа. Если нет подключенных устройств". Это исключит случайное отключение Meshtastic устройства, в случае сбоя связи и т.п.
  * В приложении Meshtastic, если необходимо, подключаем свое Meshtastic устройство.
  * Во вкладке "Настройки" открываем раздел "Сеть".
  * Включаем переключатель "WiFi включен". В соответствующие поля вводим название точки доступа WiFi вашего телефона и пароль. Нажимаем кнопку "Сохранить".
  * Устройство перезагрузиться. Необходимо будет дождаться загрузки устройства.
  * По идее, устройство подключившись к WiFi точке смартфона автоматически подключиться в приложении и вы его увидите в Подключенных устройствах. 
  * Но при необходимости, чтобы подключиться к устройству в приложении, теперь необходимо во кладке "Соединения" выбрать таб "Сеть". Настроенное на работу в WiFi сети Meshtastic устройство больше не будет подключаться через Bluetooth. И соответственно в табе "Bluetooth" вы его не найдете.
----

==== Полезные ссылки ====
  * [[https://meshtastic.org|Инструкция к сети Meshtastic]] (анг.)
  * [[https://live.paratracker.in/|Карта на которой отображаются геопозиции устройств Meshtastic]]
  * 
  * [[https://play.google.com/store/apps/details?id=com.geeksville.mesh|Приложение Meshtastic для Android]]
  * [[https://apps.apple.com/us/app/meshtastic/id1586432531|Приложение Meshtastic Apple]]
  * 
  * Сайт [[https://www.paratracker.in|paratracker.in]] с информацией о **Bir Mesh Network** (анг.)
  * Группа в Telegram [[https://t.me/BirParaglidingCommunity|Bir Paragliding Community]] (анг.) 
  * и раздел в группе [[https://t.me/BirParaglidingCommunity/6950|Mesh text]], в которую транслируются сообщения с устройств Mestastic
  * [[https://t.me/meshtastic_india|Группа в Telegram India Meshtastic Community]] (анг.)
